{% extends 'admin/master.html' %}
{% block body %}
{{ super() }}

{% if current_user.is_authenticated %}
<!-- <link rel="stylesheet" href="/static/css/all.css"> -->
<link rel="stylesheet" href="/static/css/bootstrap-table.min.css">
<section class="content-header">
        <h1>Danh sách bầu cử </h1>
        <h2 class="breadcrumb">
            <a href="/admin/add" class="btn btn-primary btn-flat pull-left">Thêm cuộc bầu cử</a>
        </h2>
    </section>
<section class="content">
        <table id="table" 
                     data-toggle="table"
                     data-search="true"
                     data-filter-control="true" 
                     data-show-export="true"
                     data-click-to-select="true">
            <thead>
                <tr>                   
                    <th class="column-header col-id">STT</th>
                    <th class="column-header col-title">Tên cuộc bầu cử</th>
                    <th class="column-header col-time_created">Ngày bầu</th>
                    <th class="column-header col-num_persons">Số lượng người bầu cử</th>
                    <th class="column-header col-min_persions">Số lượng bầu tối thiểu</th>
                    <th class="column-header col-max_persions">Số lượng bầu tối đa</th>
                    <th class="column-header col-image">Phiếu bầu cử</th>
                    <th class="column-header col-file">Danh sách bầu cử</th>
                    <th class="col-md-1">Hành động</th>
                </tr>
            </thead>

            <tbody>
                    {% set count = namespace(value=1) %}

                    {%  for dt in data  %}
                <tr>
                    <td class="col-STT">
                            {{ count.value }}
                            {% set count.value = count.value + 1 %}
                    </td>
                    <td class="col-title">
                            {{  dt['title'] }}
                    </td>

                    <td class="col-time_created">
                            {{dt['time_created'].date()}}
                    </td>

                    <td class="col-num_persons">
                            {{dt['num_persons']}}
                    </td>

                    <td class="col-min_persions">
                            {{dt['min_persions']}}
                    </td>

                    <td class="col-max_persions">
                            {{dt['max_persions']}}
                    </td>

                    <td class="col-image">
                            <a href="{{dt['image']}}" target="_blank"> Tải về
                            </a>
                    </td>
                    <td class="col-file">
                            <a href="{{dt['file'].replace("app","")}}">Tải về</a>
                    </td>

                    <td class="list-buttons-column">
                            {% if dt['status'] == 0 %}
                            <a href="/admin/election/edit/{{dt['id']}}" class="btn btn-default btn-block btn-sm">Sửa</a>
                            <a href="/admin/election/upload_zip/{{dt['id']}}" class="btn btn-primary btn-block btn-sm">Bổ sung phiếu bầu</a>
                            <a href="/admin/election/delete/{{dt['id']}}" 
                            class="btn btn-danger btn-block btn-sm" onclick="return confirm('Bạn có chắc chắn muốn xóa cuộc bầu cử này?');" >Xóa</a>
                               <!-- Cần sửa lại -->
                            {% elif dt['status'] == 1 %}
                            <button type="button" class="btn btn-warning btn-block btn-sm">Đang xử lý</button>
                            {% elif dt['status'] == 2 %}
                            <a href="/admin/election/upload_zip/{{dt['id']}}" class="btn btn-primary btn-block btn-sm">Bổ sung phiếu bầu</a>
                            <a href="/admin/statistical/detail/{{dt['id']}}" class="btn btn-info btn-block btn-sm">Xem thống kê</a>
                            <a href="/admin/election/confirm_end/{{dt['id']}}" class="btn btn-danger btn-block btn-sm" 
                            onclick="return confirm('Bạn có chắc chắn muốn kết thúc cuộc bầu cử này?');" >Kết thúc cuộc bầu cử</a>
                            {% else %}
                            <a href="/admin/statistical/detail/{{dt['id']}}" class="btn btn-info btn-block btn-sm">Xem thống kê</a>

                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    
</section>
<script src="/static/js/jquery-3.3.1.min.js"></script>
<script src="/static/js/popper.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/bootstrap-table.min.js"></script>
<script>
var $table = $('#table');
		var trBoldBlue = $("table");

	$(trBoldBlue).on("click", "tr", function (){
			$(this).toggleClass("bold-blue");
	});
</script>
<!-- /.content -->
{% else %}

<center>
    <section class="content" style="color: white">
        <div class="col-sm-12">
            <h1>Admin Manager</h1>
            <!-- <p class="lead">
                Authentication
            </p>
            <p>
                This example shows how you can use Flask-Admin in an admin template, <br> here I used AdminLTE and <a href="https://pythonhosted.org/Flask-Security/index.html" target="_blank">Flask-Security</a> for authentication.
            </p> -->
            {% if not current_user.is_authenticated %}
            <meta http-equiv="Refresh" content="0; url={{ url_for('security.login') }}" />

            <!-- email: <b>admin</b> <br> -->
            <!-- password: <b>admin</b> <br> -->
            <br>
            <p>
                <a class="btn btn-primary" href="{{ url_for('security.login') }}">Login</a>
            </p>
            {% endif %}
            <br>
            <p>
                <a class="btn btn-primary" href="/"><i class="glyphicon glyphicon-chevron-left"></i> Back</a>
            </p>
        </div>


    </section>
</center>

<br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br>
{% endif %}

{% endblock body %}